<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Abodi Blendzz | Master Barber Studio</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Bodoni+Moda:ital,wght@0,400;0,700;1,400&family=Inter:wght@300;400;600&display=swap');
        
        :root {
            --studio-dark: #0a0a0b;
            --studio-gold: #D4AF37;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--studio-dark);
            color: #f8f8f8;
            margin: 0;
            scroll-behavior: smooth;
        }

        .serif { font-family: 'Bodoni Moda', serif; }

        .glass {
            background: rgba(255, 255, 255, 0.02);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        /* Calendar Fixes */
        #calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            grid-auto-rows: 1fr;
            gap: 8px;
        }

        .day-cell {
            aspect-ratio: 1 / 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 0.75rem;
            border: 1px solid rgba(255, 255, 255, 0.05);
            font-size: 0.875rem;
            transition: all 0.2s;
            background: rgba(255,255,255,0.02);
        }

        .day-cell.selected-day {
            background-color: var(--studio-gold) !important;
            color: black !important;
            font-weight: 700;
            border-color: var(--studio-gold);
        }

        /* Admin Modal Fixes */
        #admin-modal {
            display: none;
            position: fixed;
            inset: 0;
            z-index: 99999;
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(10px);
            padding: 1.5rem;
            overflow-y: auto;
        }

        input {
            background: rgba(255,255,255,0.05) !important;
            border: 1px solid rgba(255,255,255,0.1) !important;
            color: white !important;
        }

        .hero-bg {
            background: linear-gradient(to bottom, rgba(10,10,11,0.6), rgba(10,10,11,1)), 
                        url('https://images.unsplash.com/photo-1512690196236-0275817c8052?q=80&w=2070&auto=format&fit=crop');
            background-size: cover;
            background-position: center;
        }
    </style>
</head>
<body class="selection:bg-[#D4AF37] selection:text-black">

    <!-- Admin Portal -->
    <div id="admin-modal">
        <div class="max-w-xl mx-auto pt-10">
            <div id="password-gate" class="text-center">
                <h2 class="serif text-4xl mb-8 text-[#D4AF37]">Staff Login</h2>
                <div class="glass p-8 rounded-3xl">
                    <input type="password" id="admin-pw" class="w-full p-4 rounded-xl mb-4 outline-none focus:border-[#D4AF37]" placeholder="Password">
                    <button onclick="verifyAdmin()" class="w-full py-4 bg-[#D4AF37] text-black font-bold uppercase tracking-widest rounded-xl transition-transform active:scale-95">Unlock</button>
                    <button onclick="closeAdmin()" class="mt-6 text-white/30 text-xs uppercase tracking-widest block w-full">Back to Site</button>
                </div>
            </div>

            <div id="admin-content" class="hidden">
                <div class="flex justify-between items-end mb-8 border-b border-white/10 pb-4">
                    <h2 class="serif text-4xl text-[#D4AF37]">Bookings</h2>
                    <button onclick="closeAdmin()" class="text-white/40 text-[10px] uppercase">Close</button>
                </div>
                <div id="admin-bookings-list" class="space-y-4"></div>
            </div>
        </div>
    </div>

    <!-- Navigation -->
    <nav class="fixed top-0 w-full z-50 px-6 py-4 flex justify-between items-center glass">
        <a href="#" class="serif text-xl font-bold tracking-widest uppercase">ABODI <span class="text-[#D4AF37]">BLENDZZ</span></a>
        <a href="#book" class="bg-white text-black px-5 py-2 rounded-full text-[10px] font-bold uppercase tracking-widest active:scale-90 transition">Book Now</a>
    </nav>

    <!-- Hero -->
    <header class="h-[80vh] flex flex-col items-center justify-center text-center px-6 hero-bg">
        <h2 class="serif italic text-2xl mb-2 text-[#D4AF37]">Master Barbering</h2>
        <h1 class="serif text-6xl md:text-9xl font-bold tracking-tighter mb-8 uppercase leading-none">Abodi <br> Blendzz</h1>
        <div class="w-16 h-[1px] bg-[#D4AF37] mb-8"></div>
        <p class="max-w-md text-white/50 text-xs leading-relaxed uppercase tracking-[0.3em]">Precision fades & detailed architecture.</p>
    </header>

    <!-- Booking Engine -->
    <section id="book" class="py-24 px-6">
        <div class="max-w-2xl mx-auto">
            <div class="glass p-6 md:p-12 rounded-[2.5rem]">
                <div class="text-center mb-10">
                    <h2 class="serif text-4xl mb-2 text-[#D4AF37]">Schedule</h2>
                    <p class="text-[10px] uppercase tracking-[0.3em] text-white/40">Select a date and time</p>
                </div>

                <div id="booking-app">
                    <div class="flex justify-between items-center mb-6 px-2">
                        <button onclick="changeMonth(-1)" class="p-2 text-[#D4AF37] font-bold">←</button>
                        <h3 id="monthLabel" class="serif text-xl italic text-white"></h3>
                        <button onclick="changeMonth(1)" class="p-2 text-[#D4AF37] font-bold">→</button>
                    </div>
                    
                    <div class="grid grid-cols-7 gap-2 mb-4 text-center text-[10px] text-white/20 uppercase font-bold">
                        <div>S</div><div>M</div><div>T</div><div>W</div><div>T</div><div>F</div><div>S</div>
                    </div>
                    <!-- Calendar Grid -->
                    <div id="calendar" class="mb-10"></div>

                    <!-- Time Slots -->
                    <div id="slots" class="grid grid-cols-3 gap-3 mb-10"></div>

                    <!-- Client Info -->
                    <div class="space-y-4">
                        <input type="text" id="name" placeholder="Your Name" class="w-full p-4 rounded-xl outline-none focus:border-[#D4AF37]">
                        <input type="tel" id="phone" placeholder="Phone Number" class="w-full p-4 rounded-xl outline-none focus:border-[#D4AF37]">
                        <button id="bookBtn" disabled onclick="handleBooking()" class="w-full py-5 bg-[#D4AF37] text-black font-bold uppercase tracking-widest rounded-xl disabled:opacity-20 transition-all active:scale-95">
                            Confirm Appointment
                        </button>
                    </div>
                    <div id="status" class="mt-6 text-center text-xs font-bold text-[#D4AF37] tracking-widest"></div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="py-20 text-center border-t border-white/5">
        <div class="max-w-xs mx-auto">
            <h3 class="serif text-2xl mb-4 tracking-widest uppercase">ABODI <span class="text-[#D4AF37]">BLENDZZ</span></h3>
            <p id="admin-trigger" class="text-[9px] text-white/20 uppercase tracking-[0.5em] leading-loose cursor-pointer select-none">
                © 2025 ABODI BLENDZZ STUDIO<br>STRICTLY BY APPOINTMENT
            </p>
        </div>
    </footer>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, query, where, onSnapshot, addDoc, serverTimestamp, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Global Variable Handlers for Canvas Environment
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {
            apiKey: "", authDomain: "", projectId: "", storageBucket: "", messagingSenderId: "", appId: ""
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'abodi-blendzz-site';

        let currentView = new Date();
        let selectedDate = null;
        let selectedTime = null;
        const ADMIN_PASS = "SebSucks123";

        // Global functions for buttons
        window.closeAdmin = () => { document.getElementById('admin-modal').style.display = 'none'; };
        window.changeMonth = (dir) => { 
            currentView.setMonth(currentView.getMonth() + dir); 
            renderCalendar(); 
        };

        // Admin Trigger
        document.getElementById('admin-trigger').addEventListener('click', () => {
            document.getElementById('admin-modal').style.display = 'block';
        });

        onAuthStateChanged(auth, u => { 
            if(u) renderCalendar(); 
            else signInAnonymously(auth); 
        });

        const HOURS = { 1:{s:9,e:18}, 2:{s:9,e:18}, 3:{s:9,e:18}, 4:{s:9,e:20}, 5:{s:9,e:20}, 6:{s:10,e:16}, 0:null };

        function renderCalendar() {
            const grid = document.getElementById('calendar'); grid.innerHTML = '';
            const y = currentView.getFullYear(), m = currentView.getMonth();
            document.getElementById('monthLabel').textContent = currentView.toLocaleDateString('en-US', {month:'long', year:'numeric'});
            
            const firstDayOfMonth = new Date(y, m, 1).getDay();
            const daysInMonth = new Date(y, m+1, 0).getDate();
            const today = new Date(); today.setHours(0,0,0,0);

            // Padding for empty days
            for(let i=0; i<firstDayOfMonth; i++) {
                const empty = document.createElement('div');
                empty.className = 'aspect-square'; // Maintain grid structure
                grid.appendChild(empty);
            }

            for(let d=1; d<=daysInMonth; d++) {
                const dateObj = new Date(y, m, d);
                const ds = `${y}-${String(m+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
                const cell = document.createElement('div');
                cell.textContent = d;
                cell.className = 'day-cell';
                
                if(dateObj < today || !HOURS[dateObj.getDay()]) {
                    cell.classList.add('opacity-10', 'cursor-not-allowed');
                } else {
                    cell.classList.add('cursor-pointer', 'hover:border-[#D4AF37]');
                    cell.onclick = () => {
                        document.querySelectorAll('.day-cell').forEach(c => c.classList.remove('selected-day'));
                        cell.classList.add('selected-day');
                        selectedDate = ds;
                        loadSlots(ds);
                    };
                }
                grid.appendChild(cell);
            }
        }

        function loadSlots(ds) {
            const container = document.getElementById('slots');
            const h = HOURS[new Date(ds + 'T00:00:00').getDay()];
            const q = query(collection(db, 'artifacts', appId, 'public', 'data', 'bookings'), where("date", "==", ds));
            
            onSnapshot(q, snap => {
                const taken = snap.docs.map(d => d.data().time);
                container.innerHTML = '';
                if(!h) return;
                
                for(let i=h.s; i<h.e; i++) {
                    const timeStr = `${i%12||12}:00 ${i>=12?'PM':'AM'}`;
                    const b = document.createElement('button');
                    b.textContent = timeStr;
                    b.className = 'py-4 border border-white/10 rounded-xl text-[10px] font-bold uppercase tracking-widest transition-all';
                    if(taken.includes(timeStr)) { 
                        b.disabled = true; 
                        b.className += ' opacity-5 cursor-not-allowed line-through'; 
                    } else {
                        b.onclick = () => {
                            document.querySelectorAll('#slots button').forEach(x => x.classList.remove('bg-[#D4AF37]','text-black'));
                            b.classList.add('bg-[#D4AF37]','text-black');
                            selectedTime = timeStr;
                            document.getElementById('bookBtn').disabled = false;
                        };
                    }
                    container.appendChild(b);
                }
            }, (err) => {
                console.error("Firestore error:", err);
            });
        }

        window.handleBooking = async () => {
            const btn = document.getElementById('bookBtn');
            const name = document.getElementById('name').value;
            const phone = document.getElementById('phone').value;
            if(!name || !phone) return;
            
            btn.disabled = true;
            try {
                await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'bookings'), {
                    date: selectedDate, time: selectedTime,
                    name: name, phone: phone,
                    ts: serverTimestamp()
                });
                document.getElementById('status').textContent = "BOOKING SUCCESSFUL";
                document.getElementById('name').value = '';
                document.getElementById('phone').value = '';
                document.getElementById('slots').innerHTML = '';
                selectedTime = null;
                btn.disabled = true;
            } catch(e) { 
                btn.disabled = false; 
                console.error("Booking error:", e);
            }
        }

        window.verifyAdmin = () => {
            if(document.getElementById('admin-pw').value === ADMIN_PASS) {
                document.getElementById('password-gate').classList.add('hidden');
                document.getElementById('admin-content').classList.remove('hidden');
                loadAdmin();
            } else {
                alert("Incorrect Password");
            }
        }

        function loadAdmin() {
            onSnapshot(query(collection(db,'artifacts',appId,'public','data','bookings')), snap => {
                const list = document.getElementById('admin-bookings-list'); list.innerHTML = '';
                const sorted = snap.docs.map(d => ({id:d.id, ...d.data()})).sort((a,b) => a.date.localeCompare(b.date));
                
                if(sorted.length === 0) {
                    list.innerHTML = '<p class="text-center opacity-40 text-xs py-10 uppercase tracking-widest">No Active Bookings</p>';
                }

                sorted.forEach(b => {
                    const div = document.createElement('div');
                    div.className = 'glass p-6 rounded-3xl flex justify-between items-center';
                    div.innerHTML = `<div><p class="text-[#D4AF37] text-[10px] uppercase font-bold tracking-widest mb-1">${b.date} @ ${b.time}</p>
                                    <p class="serif text-xl font-bold">${b.name}</p>
                                    <p class="text-sm opacity-40">${b.phone}</p></div>
                                    <button onclick="deleteBooking('${b.id}')" class="text-red-900 text-[10px] font-bold px-4 py-2 hover:bg-red-900/10 rounded-lg transition">DELETE</button>`;
                    list.appendChild(div);
                });
            });
        }
        window.deleteBooking = async (id) => { 
            if(confirm('Delete booking?')) {
                await deleteDoc(doc(db,'artifacts',appId,'public','data','bookings',id)); 
            }
        }
    </script>
</body>
</html>
